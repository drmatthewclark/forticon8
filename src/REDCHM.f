C
C     FORTICON8  JANUARY 2018
C     MATTHEW CLARK
C
      SUBROUTINE REDCHM(U,N5)
      IMPLICIT REAL*8(A-H,O-Z)
      INCLUDE 'PARAMETERS'

      DIMENSION U(N5,N5)

      COMMON/CNTRL/CON,PEEP,COULH,NH,NA,NATM,KA,NELEC,METH,IPRINT,
     1IPUNCH,L1,L2,L3,L4,L5,ONEMAT,ITERAT
      LOGICAL*1 L1,L2,L3,L4,L5,ONEMAT,ITERAT
 
      INCLUDE 'ATOMCOMMON'

C
C    SUBROUTINE TO CALCULATE REDUCED CHARGE MATRIX.
C
      IF(NA.EQ.0) RETURN
      NH1=NH+1
      IAO=NH1
      ISUB=NH1
      DO 128 I=1,NA
      KEYI=KEY(I)
      IF(NP(KEYI)) 122,121,122
 121  IATOP=IAO
      GO TO 125
 122  IF(ND(KEYI)) 124,123,124
 123  IATOP=IAO+3
      GO TO 125
 124  IATOP=IAO+8
 125  DO 127 J=1,N5
      SUM=0.D0
      DO 126 K=IAO,IATOP
 126  SUM=SUM+U(K,J)
 127  U(ISUB,J)=SUM
      ISUB=ISUB+1
 128  IAO=IATOP+1
      RETURN
      END
